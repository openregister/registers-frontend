<script>
  /* global ga, window */
  window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments); };

  ga('create', '<%= Rails.configuration.x.google_analytics.frontend_tracking_id %>', 'auto')

  <% if @custom_dimension2.present? %>
    ga('set', 'dimension2','<%= @custom_dimension2.downcase %>')
  <% end %>

  <% if @register&.register_phase.present? %>
    ga('set', 'dimension3','<%= @register.register_phase %>')
  <% end %>

  ga('set', 'anonymizeIp', true)
  ga('set', 'displayFeaturesTask', null)
  ga('set', 'transport', 'beacon')

  ga('create', 'UA-145652997-1', 'auto', 'govuk_shared', {'allowLinker': true});
  ga('govuk_shared.require', 'linker');
  ga('govuk_shared.linker.set', 'anonymizeIp', true);
  ga('govuk_shared.linker:autoLink', ['registers.service.gov.uk', 'www.gov.uk']);

  ga('send', 'pageview')
  ga('govuk_shared.send', 'pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>