- @page_title = @page.seo_title
- @page_description = @page.description
- @body_class = 'registers-index'

%nav{class: "breadcrumbs", "aria-label" => "Breadcrumbs"}
  %ol{itemscope: "", itemtype: "http://schema.org/BreadcrumbList"}
    %li{class: "breadcrumbs__item", itemprop: "itemListElement", itemscope: "", itemtype: "http://schema.org/ListItem"}
      = link_to "https://www.gov.uk/service-toolkit#components", itemprop: "item" do
        %span{itemprop: "name"} Components
    %li{class: "breadcrumbs__item", itemprop: "itemListElement", itemscope: "", itemtype: "http://schema.org/ListItem"}
      = link_to root_path, itemprop: "item" do
        %span{itemprop: "name"} GOV.UK Registers
    %li{class: "breadcrumbs__item #{'breadcrumbs__item--active' unless params[:phase].present?}", itemprop: "itemListElement", itemscope: "", itemtype: "http://schema.org/ListItem"}
      %a{href: "/registers", itemprop: "item"}
        %span{itemprop: "name"}= @page.menu_title
    - if params[:phase].present?
      %li{class: "breadcrumbs__item breadcrumbs__item--active", itemprop: "itemListElement", itemscope: "", itemtype: "http://schema.org/ListItem"}
        %a{href: "#main", itemprop: "item"}
          %span{itemprop: "name"} Registers in #{params[:phase]}

.container
  .grid-row
    .column-one-whole
      .govspeak
        = govspeak(@page.content(:text))

  - if params[:phase].present?
    .grid-row
      .column-one-third
        .data
          %span.data-item.bold-xxlarge= @registers.size
          %span.data-item.bold-xsmall Registers #{params[:phase]}

  - else
    .grid-row
      .column-one-quarter
        .data
          = link_to registers_path(phase: 'ready to use') do
            %span.data-item.bold-xxlarge= @registers.where(register_phase: 'Beta').count
            %span.data-item.bold-xsmall Registers ready for use
      .column-one-quarter
        .data
          = link_to registers_path(phase: 'in progress') do
            %span.data-item.bold-xxlarge= @registers.where.not(register_phase: 'Beta').count
            %span.data-item.bold-xsmall Registers in progress

  .grid-row
    .column-two-thirds.js-hidden
      %div{class: "js-filter-list", "aria-hidden" => "true"}
        %form.js-filter-form
          %fieldset
            .form-group
              %label{class: "form-label", for: "search"} Search for a register
              %input{name: "search", id: "search", class: "form-control form-control-3-4"}

    .column-one-whole
      %h3.heading-small.mq-small-only Sort by:
      %table.register-status-table.table-collapsible
        %thead
          %tr
            %th{role: "columnheader", scope: "col"}
              = sort_link(@search, :name, "Register", default_order: :desc)
            %th{role: "columnheader", scope: "col"}
              = sort_link(@search, :phase_name, "Status", default_order: :desc)
            %th{role: "columnheader", scope: "col"}
              = sort_link(@search, :register_authority, "Managed by", default_order: :asc)
            %th{role: "columnheader", scope: "col", colspan: "2"}
        %tbody.js-filter-block
          - @registers.each_with_index do |register, index|
            - index = index + 1
            = render partial: 'spina/registers/register', object: register, locals: { index: index }

      %h3.heading-medium Suggest a register
      = link_to "Find out more", spina.new_register_path

= content_for :javascript do
  :javascript
    jQuery(function($) {
      GOVUK.filterListItems.init();
    });
