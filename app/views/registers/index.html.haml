- @page_title = 'Get data'
- content_for :body_classes, 'register-index'

%nav.breadcrumbs{role: "Navigation", "aria-label" => "Breadcrumb"}
  %ol
    %li.breadcrumbs__item
      = link_to 'Components', 'https://www.gov.uk/service-toolkit#components'
    %li.breadcrumbs__item
      = link_to 'GOV.UK Registers', root_path
    %li.breadcrumbs__item.breadcrumbs__item--active
      = link_to 'Register collection', '#content', 'aria-current' => 'page'

    .column-full
      - if @registers.present?
        - if @search_term
          .search-results
            %p
              Results found for <strong>"#{@search_term}"</strong>
              = link_to 'Reset', registers_path, class: 'reset-link'
        .grid-row
          .column-full
            - if @registers.featured.present? && !@search_term
              %h2.heading-small Featured
              %ol.app-c-highlight-boxes
                - @registers.featured.by_popularity.each do |register|
                  %li.app-c-highlight-boxes__item-wrapper
                    .app-c-highlight-boxes__item
                      %h3.app-c-highlight-boxes__title= link_to register.register_name, register_path(register.slug)
                      %p.app-c-highlight-boxes__description= register.register_description
                      - if register.authority.present?
                        %div{class: "govuk-organisation-logo #{register&.authority&.name.parameterize}"}
                          %div{class: "logo-container #{crest_class_name(register&.authority&.name.parameterize)}"}
                            %span= register&.authority&.name


            %table.register-status-table.table-collapsible
              %col{width: '80%'}
              %col{width: '20%'}
              %thead
                %tr
                  %th{role: "columnheader", scope: "col"}
                    Register
                  %th{role: "columnheader", scope: "col"}
                    Managed by
              %tbody
                - @registers.by_name.each do |register|
                  %tr
                    %td
                      %p
                        %strong= link_to register.register_name, register_path(register.slug)
                        %br
                        = register.register_description
                    %td
                      - if register.authority.present?
                        %div{class: "govuk-organisation-logo #{register&.authority&.name&.parameterize}"}
                          %div{class: "logo-container #{crest_class_name(register&.authority&.name&.parameterize)}"}
                            %span= register&.authority&.name

      - else
        %p
          No results found for <strong>"#{@search_term}"</strong>
          = link_to 'Reset', registers_path, class: 'reset-link'
        %script
          ga('send', 'event', 'Search', 'No results', '#{@search_term}', {nonInteraction: true});

= content_for :javascript do
  :javascript
    $("input[name='sort']").change(function () {
      $('.sort-registers').submit();
    });
